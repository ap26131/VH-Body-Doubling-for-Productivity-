<!DOCTYPE html>

<!--QUIZ W/ VH -->
<!--Interactive w/ VH-->
<!--SOUND-->
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Work Sheet with Virtual Human and WebGazer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
   
    
    <style>

    
   /* SPLIT SCREEN */ 
   body {
        margin: 0;
        padding: 0;
        height: 100vh;
        display: flex;
    }

    .panel {
          
          height: 100%;
          overflow-y: scroll; 
          border: 1px solid #ccc;
          position: relative; 
        }

        .panel-left {
          background-color: #f0f0f0;
          z-index: 5; 
          width: 55%;
        }

        .panel-right {
          background-color: #d0e0f0;
          position: relative;
          z-index: 10; 
          width: 45%;
        }


    button {
        display: block;
        margin-top: 20px;
        padding: 10px 15px;
        background-color: #4CAF50;
        color: white;
        border: none;
        cursor: pointer;
        margin-bottom: 20px;
    }

    button:hover {
        background-color: #45a049;
    }

    .button-container {
        display: flex; 
        justify-content: flex-start; 
        gap: 10px; 
    }

    .text-box {
        border: 2px solid #333; 
        padding: 20px; 
        width: 90%; 
        height: 500px;
        background-color: #f0f0f0; 
        font-family: Arial, sans-serif;
        resize: none; 
        overflow-y: scroll; 
        margin-bottom: 20px;
    }

    .question {
        margin-bottom: 20px;
    }

    .question h3 {
        margin-bottom: 10px;
    }

    

    .char-count {
        margin-top: 10px;
        font-size: 14px;
        color: #555;
    }

   

     /* UNITY CONTAINER */
     #unity-container.unity-desktop {
          width: 100%; 
          height: 100%; 
          position: relative; 
          z-index: 4; 
        }
  
        #unity-canvas {
          width: 100%;
          height: 100%;
          background: #231F20;
          z-index: 4;
        }
  
        #unity-loading-bar {
          position: absolute; 
          left: 50%; 
          top: 50%; 
          transform: translate(-50%, -50%);
          display: none;
          z-index: 4;
        }
  
        #unity-logo { width: 154px; height: 130px; }
        #unity-progress-bar-empty { width: 141px; height: 18px; }
        #unity-progress-bar-full { width: 0%; height: 18px; }
        #unity-footer { position: relative; z-index: 4; }

    </style>
  </head>


  <body>

    
    <div class="panel panel-left">
        <div id="unity-container" class="unity-desktop">
          <canvas id="unity-canvas"></canvas>
          <div id="unity-loading-bar">
            <div id="unity-logo"></div>
            <div id="unity-progress-bar-empty">
              <div id="unity-progress-bar-full"></div>
            </div>
          </div>
          <div id="unity-footer"></div>
        </div>
      </div>
    
  

     <!-- RIGHT SIDE: Worksheet -->
     <div class="panel panel-right">
     
     
        <!-- TOP BUTTONS -->
      <div class="button-container">
        <button onclick="store_points_variable()">Start Storing Points</button>
        <button onclick="stop_storing_points_variable()">Stop Storing Points</button>
      </div>

       <!--The Story-->
       <div class="text-box">
        <h4>The Great Bread Revolution </h4>
        <p> Once upon a time in France, there was a boy named Pierre who lived in a tiny village called Montclair. His family ran the local bakery, famous for their delicious bread. The secret ingredient? "Lots of love and a sprinkle of flour," Pierre’s father would say, though Pierre was pretty sure it was just butter. Anyway, people from all over the village came for the bread—until one day, they stopped. It all started when the price of flour shot up like a rocket. Suddenly, Pierre’s father could barely afford enough flour to make even a baguette. "We’re being taxed more than a fancy cheese at a rich man's party!" his father grumbled, tossing his hat onto the table. The trouble was the king, Louis XVI, and his queen, Marie Antoinette. They lived in a palace so big, it probably had enough rooms to lose an entire herd of cows in there. But what really upset people was that while Pierre’s family couldn’t afford flour, the king and queen were swimming in cakes and pastries. "Let them eat cake," they supposedly said, which made Pierre think, *Hey, I wouldn’t mind some cake right about now.* But that wasn't really the point. One evening, as Pierre was staring sadly at a single loaf of bread (which had to last a week), his father slammed his fist on the table and declared, "Enough is enough! The people are rising up! No more taxes, no more kings! We want... uh, we want... cheaper flour!" Pierre was confused. "Is this really all about flour, Papa?" His father waved him off. "Flour, taxes, unfairness—pick one! The Revolution is happening! I’m going to Paris!" "Wait... now?" Pierre asked. But his father was already packing. "Who's going to bake the bread?" Pierre’s father froze. "Uh... you are." And just like that, Pierre was in charge of the bakery. With his father off to join the revolution, it was up to him and his mother to keep the business running. Except, well, they had no flour. So Pierre, ever the problem-solver, got creative. First, he tried stretching the bread dough with mashed potatoes. "Potato bread’s a thing, right?" It wasn’t. The bread came out looking like a lumpy rock, and tasted even worse. Then he tried baking bread using corn instead of wheat, but all he made was popcorn. "At least we can snack while we starve," his mother said, ever the optimist. Meanwhile, in Paris, Pierre’s father was having the time of his life. The streets were filled with people shouting, "Liberty! Equality! And Bread!" Well, mostly bread. The big event was storming the Bastille, a massive prison that no one liked. Pierre’s father got swept up in the crowd, and though he didn’t really know what was going on, he figured it was a great place to complain about flour prices. "Down with the king! And while we’re at it, could we get a better deal on flour?" Pierre’s father yelled. A few people nodded in agreement. They stormed the gates, and somehow, amidst all the chaos, Pierre’s dad managed to snag a baguette from a vendor. "Finally, some decent bread!" he cheered, munching away. Back in Montclair, Pierre had just about given up. The bakery was empty, and he was staring at a loaf of bread that had fallen on the floor. "Well, at least it can’t get worse," he muttered, right before his mother announced they were out of butter too. "Great," Pierre sighed. But then, his father returned from Paris, waving a flag and carrying a sack of—could it be?—flour! "We did it!" his father shouted. "The king’s been kicked out, and now we’re building a new France. A France where flour is affordable and bread is plentiful!" Pierre raised an eyebrow. "So, uh, is the price of flour really lower?" His father hesitated. "Well... not exactly yet. But the good news is that we’re in charge now! No more kings telling us what to do!" "So... we still can’t make bread?" Pierre asked. His father looked at the sack of flour he brought back. "Okay, so I bought this on the way home with the last of our coins. But freedom! Think of the freedom!" Pierre stared at the flour, then at his father, and finally burst out laughing. "So we went through all that just to have no flour... but at least now we’re free to be broke?" His father grinned. "Exactly! Isn’t it great?" Pierre couldn’t help but laugh. It was all a bit ridiculous, really. They were free, yes, but still struggling. Yet, somehow, things felt different. People were working together, making their voices heard. And even if they were still broke, they were at least broke *together*. As the days went by, the bakery got back on its feet. People started returning, not because the bread was suddenly amazing (it still had a tendency to come out a little lumpy), but because there was hope in the air. And if there was one thing that went well with bread, it was hope. And so, Pierre’s family continued baking, with a little more laughter, a lot more stories about Paris, and a determination that no king—or lack of flour—could ever take away their joy. "Long live the bread!" Pierre’s father would shout every morning, and Pierre would just shake his head, chuckling. "Papa, I think you mean, 'Long live the revolution!'" "Eh, same thing," his father would reply with a wink. </p>
      </div>

      <div class="question" id="question1">
        <h3>What was Pierre’s primary motivation for getting creative with the bread recipes?</h3>
        <label><input type="radio" name="q1" value="incorrect"> To improve flavor </label><br>
        <label><input type="radio" name="q1" value="incorrect"> To impress the king </label><br>
        <label><input type="radio" name="q1" value="correct"> Lack of flour </label><br>
        <label><input type="radio" name="q1" value="incorrect"> To create a new recipe </label><br>
      </div>

      <div class="question" id="question2">
        <h3>Who did the king and queen allegedly suggest should eat cake?</h3>
        <label><input type="radio" name="q2" value="incorrect"> Their servants </label><br>
        <label><input type="radio" name="q2" value="incorrect"> The villagers </label><br>
        <label><input type="radio" name="q2" value="incorrect"> Themselves </label><br>
        <label><input type="radio" name="q2" value="correct"> The poor people </label><br>
      </div>

      <div class="question" id="question3">
        <h3>What did the bakery symbolize for the villagers?</h3>
        <label><input type="radio" name="q3" value="incorrect"> Power </label><br>
        <label><input type="radio" name="q3" value="incorrect"> Wealth </label><br>
        <label><input type="radio" name="q3" value="correct"> Hope and togetherness </label><br>
        <label><input type="radio" name="q3" value="incorrect"> Freedom from hunger </label><br>
      </div>

      <div class="question" id="question4">
        <h3>What major event inspired Pierre's father to join the protests?</h3>
        <label><input type="radio" name="q4" value="correct"> The high cost of flour </label><br>
        <label><input type="radio" name="q4" value="incorrect"> A speech from the king </label><br>
        <label><input type="radio" name="q4" value="incorrect"> News of a neighboring revolution </label><br>
        <label><input type="radio" name="q4" value="incorrect"> Pierre’s encouragement </label><br>
      </div>
      
      <div class="question" id="question5">
        <h3>How did the villagers respond to Pierre’s family after his father’s return from Paris?</h3>
        <label><input type="radio" name="q5" value="incorrect"> They criticized them </label><br>
        <label><input type="radio" name="q5" value="correct"> They cheered for them </label><br>
        <label><input type="radio" name="q5" value="incorrect"> They ignored them </label><br>
        <label><input type="radio" name="q5" value="incorrect"> They demanded free bread </label><br>
      </div>

      <div class="question" id="question6">
        <h3>What was the mood in the village after the Revolution?</h3>
        <label><input type="radio" name="q6" value="correct"> Hopeful and energized </label><br>
        <label><input type="radio" name="q6" value="incorrect"> Angry and bitter </label><br>
        <label><input type="radio" name="q6" value="incorrect"> Fearful and confused </label><br>
        <label><input type="radio" name="q6" value="incorrect"> Sad and disappointed </label><br>
      </div>

      <div class="question" id="question7">
        <h3>What special event was celebrated in Pierre’s village after the Revolution?</h3>
        <label><input type="radio" name="q7" value="incorrect"> A new bakery opening </label><br>
        <label><input type="radio" name="q7" value="incorrect"> Pierre’s birthday </label><br>
        <label><input type="radio" name="q7" value="correct"> The freedom of the people </label><br>
        <label><input type="radio" name="q7" value="incorrect"> A royal holiday </label><br>
      </div>

      <div class="question" id="question8">
        <h3>What is the underlying theme Pierre’s family discovered by the end of the story?</h3>
        <label><input type="radio" name="q8" value="correct"> Resilience and unity </label><br>
        <label><input type="radio" name="q8" value="incorrect"> Wealth and prosperity </label><br>
        <label><input type="radio" name="q8" value="incorrect"> Skill in bread-making </label><br>
        <label><input type="radio" name="q8" value="incorrect"> Political power </label><br>
      </div>

      <!-- Submit and Exit Buttons -->
      <div class="button-container">
        <button onclick="checkAnswers()">Submit</button>
        <button onclick="window.location.href='home.html'">Exit</button>
        <div id="result"></div>
      </div>
    </div>
  

 
<!-- JavaScript -->

<!-- Validate quiz -->

<script>
  function validateQuiz() {
    const questions = ['q1', 'q2', 'q3', 'q4', 'q5', 'q6', 'q7', 'q8']; // List of question names
    let allAnswered = true;

    for (let i = 0; i < questions.length; i++) {
      const q = questions[i];
      const radios = document.getElementsByName(q);
      let answered = false;

      // Check if at least one radio button in the group is checked
      for (const radio of radios) {
        if (radio.checked) {
          answered = true;
          break;
        }
      }

      if (!answered) {
        alert(`Please answer Question ${i + 1}.`); // Use i + 1 for the correct question number
        allAnswered = false;
        break; // Stop checking after finding the first unanswered question
      }
    }

    return allAnswered; // Return true if all questions are answered
  }
</script>

<script>
  const form = document.getElementById('quiz-form');
  const resultDiv = document.getElementById('result');

  form.addEventListener('submit', async (event) => {
    event.preventDefault(); // Prevent the page from reloading

    // Validate the quiz before submitting
    const allAnswered = validateQuiz();
    if (!allAnswered) {
      return; // Stop here if not all questions are answered
    }

    const formData = new FormData(form);
    const data = new URLSearchParams(formData);

    try {
      const response = await fetch('/submit-quiz', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: data,
      });

      const result = await response.json();
      resultDiv.innerHTML = `<h2>Your Score: ${result.score}/8</h2>`;
    } catch (error) {
      console.error('Error submitting quiz:', error);
      resultDiv.innerHTML = `<h2>Error submitting quiz. Please try again.</h2>`;
    }
  });
</script>

<script>
  document.getElementById('exit').addEventListener('click', async () => {
    stopGazeTracking();
    try {
      // Send the GazePoints to the server
      const response = await fetch('/send-gaze-data', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ data: getGazePoints() })
      });

      if (response.ok) {
        // Redirect to home.html after successful send
        window.location.href = 'home.html';
      } else {
        console.error('Failed to send data', response.status);
      }
    } catch (error) {
      console.error('Error:', error);
    }
  });
</script>

<script>

    function checkAnswers() {
      let score = 0;
  
      const q1 = document.querySelector('input[name="q1"]:checked');
      const q2 = document.querySelector('input[name="q2"]:checked');
      const q3 = document.querySelector('input[name="q3"]:checked');
      const q4 = document.querySelector('input[name="q4"]:checked');
      const q5 = document.querySelector('input[name="q5"]:checked');
      const q6 = document.querySelector('input[name="q6"]:checked');
      const q7 = document.querySelector('input[name="q7"]:checked');
      const q8 = document.querySelector('input[name="q8"]:checked');
  
      // Increment score for correct answers
      if (q1 && q1.value === 'correct') score++;
      if (q2 && q2.value === 'correct') score++;
      if (q3 && q3.value === 'correct') score++;
      if (q4 && q4.value === 'correct') score++;
      if (q5 && q5.value === 'correct') score++;
      if (q6 && q6.value === 'correct') score++;
      if (q7 && q7.value === 'correct') score++;
      if (q8 && q8.value === 'correct') score++;
  
      // Display result using an alert
      alert(`You scored ${score} out of 8.`);
    }
    
  </script>

   <!-- UNITY SCRIPTS -->
   <script>
    var container = document.querySelector("#unity-container");
    var canvas = document.querySelector("#unity-canvas");
    var loadingBar = document.querySelector("#unity-loading-bar");
    var progressBarFull = document.querySelector("#unity-progress-bar-full");
    var warningBanner = document.querySelector("#unity-warning");



    var buildUrl = "BuildCOMPLEX";
      var loaderUrl = buildUrl + "/TWENTY.loader.js";
      var config = {
        dataUrl: buildUrl + "/TWENTY.data",
        frameworkUrl: buildUrl + "/TWENTY.framework.js",
        codeUrl: buildUrl + "/TWENTY.wasm",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "DefaultCompany",
        productName: "Attempt1",
        productVersion: "0.1",
      };

var script = document.createElement("script");
script.src = loaderUrl;
script.onload = () => {
  createUnityInstance(canvas, config, (progress) => {
    progressBarFull.style.width = 100 * progress + "%";
        }).then((unityInstance) => {
          loadingBar.style.display = "none";
        }).catch((message) => {
          alert(message);
        });
      };

document.body.appendChild(script);

</script>

 <!--OFFSCREEN TO DETECT -->
<script src="https://webgazer.cs.brown.edu/webgazer.js"></script>

<script>
  let timer = null; 
  let isOffScreen = false;


  function triggerUnityAnimation() {
    if (typeof UnityInstance !== 'undefined' && UnityInstance !== null) {
        UnityInstance.SendMessage('WaveObject', 'TriggerAnimation');
    } else {
        console.error("UnityInstance is not defined or null.");
    }
}

function triggerUnityTTS(message) {
    if (typeof UnityInstance !== 'undefined' && UnityInstance !== null) {
        UnityInstance.SendMessage('WaveObject', 'TriggerSpeech', message);
    } else {
        console.error("UnityInstance is not defined or null.");
    }
}

  // Load the audio file
 // let audio = new Audio('ding-126626.mp3'); 
    
  webgazer.setGazeListener(function(data) { 
    if (data == null) {
      return;
    }

    var xprediction = data.x; 
    var yprediction = data.y; 

    
    var viewportWidth = window.innerWidth;
    var viewportHeight = window.innerHeight;

    var minX = viewportWidth * 0.1; 
    var maxX = viewportWidth * 0.9; 
    var minY = viewportHeight * 0.1; 
    var maxY = viewportHeight * 0.9; 

    // Check if gaze is off-screen
    if (xprediction < minX || xprediction > maxX || yprediction < minY || yprediction > maxY) {
      try {
        // Send notification to server that user looked off screen
        const response = fetch('/off-screen-counter', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ action: 'off screen' })
        });
      } catch (error) {
        console.error('Error:', error);
      }

      if (!isOffScreen) { // Start timer only if not already off-screen
          isOffScreen = true;
          audio.play().catch(function(error) {
                console.error("Audio playback error:", error);
            });
            alert("Gaze has been off-screen for 10 seconds.");
            triggerUnityAnimation();
            triggerUnityTTS("Please type for assistance");
          timer = setTimeout(function() {
          }, 10000); // 10 seconds
      }
    } else {
      // Clear timer and reset if the gaze is back on-screen
      if (isOffScreen) {
          clearTimeout(timer);
          isOffScreen = false;
      }
    }
  }).begin();
</script>
    
  </body>
</html>
