<!DOCTYPE html>

<!--QUIZ W/O VH -->
<!--Interactive w/ RH-->
<!--SOUND-->

<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Work Sheet without Virtual Human and WebGazer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
   
    <style>
      body {
        margin: 0;
        padding: 0;
        height: 100vh;
        display: flex;
        position: center;
      }

      .panel {
        height: 100%;
        overflow-y: scroll; 
        border: 1px solid #ccc;
        position: relative; 
      }

      .panel-right {
        background-color: #d0e0f0;
        position: relative;
        z-index: 10; 
        width: 100%;
      }

      button {
        display: block;
        margin-top: 20px;
        padding: 10px 15px;
        background-color: #4CAF50;
        color: white;
        border: none;
        cursor: pointer;
        margin-bottom: 20px;
      }
      
      .button-container {
        display: flex; 
        justify-content: flex-start; 
        gap: 10px; 
      }

      .text-box {
        border: 2px solid #333; 
        padding: 20px; 
        width: 90%; 
        height: 500px;
        background-color: #f0f0f0; 
        font-family: Arial, sans-serif;
        resize: none; 
        overflow-y: scroll; 
        margin-bottom: 20px;
      }
            
      .char-count {
        margin-top: 10px;
        font-size: 14px;
        color: #555;
      }

      button:hover { background-color: #45a049; }
      .question { margin-bottom: 20px; }
      .question h3 { margin-bottom: 10px; }
    </style>
  </head>
  
  
  <body>
    <!-- Imports -->
    <script src="https://webgazer.cs.brown.edu/webgazer.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert@2.1.2/dist/sweetalert.min.js"></script>
    
    <!--Start gazetracking -->
    <script>
      startGazeTracking();
    </script>
  
    <!-- Validate quiz -->
    <script src="js/quiz_validationDE.js"></script>

     <!-- RIGHT SIDE: Worksheet -->
    <div class="panel panel-right">

      <!--The Story-->
      <div class="text-box">

        <h4>The Lettuce Showdown </h4>
        
        <p> The shiny metal doors of the Wilson Tower elevator closed with a soft ding, sealing six strangers inside as it began its slow ascent. It was a typical Tuesday afternoon, and no one expected anything unusual—until the elevator suddenly lurched to a stop.

          “Whoa! What’s going on?” asked Jake, a teenage boy in a hoodie, looking around in confusion.
          
          A sharp-dressed businessman, Mr. Harris, sighed loudly. “Must be the elevator jamming again,” he muttered, frantically pressing the buttons. But no matter how many times he jabbed at the controls, the elevator remained still.
          
          A crackly voice came over the intercom. “Uh, folks, this is Maintenance. Looks like a bit of a technical issue here. Gonna take an hour or so to fix it. Just sit tight.”
          
          “An hour?!” groaned Mrs. Turner, a middle-aged woman in a floral dress. “I have a meeting in 15 minutes!”
          
          Meanwhile, a college student named Maya shrugged and put her headphones back on, while Mr. Thompson, an elderly man with a cane, simply leaned against the wall, adjusting his glasses.
          
          But in the corner of the elevator stood a young chef named Emily, clutching a grocery bag with several heads of crisp, green lettuce peeking out from the top. “Well,” she said with a sigh, “this is just great. I was supposed to deliver these for the salad bar at the restaurant.”
          
          “Lettuce?” asked Jake, peeking into her bag. “What are you gonna do with all that lettuce?”
          
          Emily laughed. “Honestly, I have no idea now. It’s not like I can use it while we’re stuck in here.”
          
          Mrs. Turner, trying to lighten the mood, clapped her hands together. “Wait a minute, I have an idea! How about we have a contest?”
          
          “What kind of contest?” asked Mr. Harris, raising an eyebrow.
          
          “A lettuce-eating competition!” Mrs. Turner announced with a grin. “Each of us gets a head of lettuce, and whoever finishes theirs first wins.”
          
          “Seriously?” Mr. Harris scoffed, but the rest of the group perked up.
          
          “I’m game,” Jake said, cracking his knuckles. “I’ve always wanted to see how fast I could eat one of these.”
          
          “I guess it’s better than just standing around,” Maya said, pulling her headphones off.
          
          “Count me in,” said Mr. Thompson with a twinkle in his eye. “I could use a little fun.”
          
          Emily shrugged and reached into her bag. “Alright then, one head of lettuce for everyone!” She handed a head to each of the passengers, who looked at their leafy greens with a mix of excitement and uncertainty.
          
          “Okay, here are the rules,” Mrs. Turner declared. “You have to eat the entire head of lettuce—no tearing off tiny pieces and nibbling. Whoever finishes theirs first wins... well, bragging rights.”
          
          Jake grinned. “Oh, it’s on!”
          
          
          “On your marks, get set... GO!” Mrs. Turner shouted, and everyone dove into their heads of lettuce.
          
          Jake, ever the competitor, attacked his lettuce with enthusiasm, tearing huge chunks with his teeth. “This is easier than I thought!” he mumbled through a mouthful of leaves.
          
          Meanwhile, Mr. Harris was more methodical, chewing quickly and efficiently. “This is ridiculous,” he muttered, but a hint of a smile tugged at the corners of his mouth.
          
          Maya was surprisingly fast, her competitive spirit coming out as she tore through her lettuce like it was an assignment with a tight deadline. “I’ve been through worse finals,” she joked between bites.
          
          Mr. Thompson, though slower, was determined. He chewed thoughtfully, savoring each bite. “It’s been years since I’ve had fresh lettuce,” he said with a nostalgic smile. “Takes me back to my garden days.”
          
          Mrs. Turner, however, was struggling. “This... is tougher... than I thought!” she gasped, wiping lettuce juice from her chin.
          
          Meanwhile, Emily was munching away steadily, clearly accustomed to handling food but not necessarily eating it this quickly. “I never thought I’d have to eat an entire head of lettuce on the go,” she said, laughing.
          
          The elevator was filled with the sound of crunching leaves, laughter, and the occasional groan. Every now and then, someone would choke and sputter, only to get back into the game with renewed determination.
          
          “Come on, guys, hurry up!” Jake taunted, glancing around. “I’m almost done!”
          
          But just as he was about to take his final bite, Maya pulled ahead with a sudden burst of speed. “No way am I letting you win!” she said, cramming the last of her lettuce into her mouth.
          
          Mr. Harris, sensing he was falling behind, started shoveling huge chunks into his mouth, his suit now covered in green flecks. “I did not plan for my lunch break to turn into this madness,” he grumbled, but he couldn’t stop himself from trying to win.
          
          Mr. Thompson, now down to his last few leaves, cheered on his competitors. “This is more fun than bingo night!”
          
          Suddenly, the elevator jolted and began moving again. The unexpected motion caused everyone to stumble, and lettuce leaves went flying.
          
          “Quick! Finish before we reach the next floor!” Mrs. Turner urged, stuffing the last of her lettuce into her mouth.
          
          In a final, desperate push, Emily, Jake, and Maya all crammed the remaining bits of their lettuce into their mouths. The elevator dinged, signaling that it was arriving at a floor.
          
          With one final bite, Maya threw her arms up in victory. “I did it!” she declared, her cheeks puffed out like a chipmunk’s. “I’m the Lettuce Champion!”
          
          The doors opened, revealing a confused maintenance worker staring at the disheveled group surrounded by lettuce leaves. “Uh... what exactly happened in here?” he asked, scratching his head.
          
          “We had a lettuce-eating contest,” Jake said proudly, wiping his mouth. “And she won.”
          
          The maintenance worker shook his head in disbelief. “Well, whatever keeps you entertained, I guess.”
          
          As they stepped out of the elevator, Mrs. Turner patted Maya on the back. “Well done, champ. You’ve earned the title of Lettuce Queen.”
          
          Mr. Harris adjusted his tie, now stained green. “I’ll be finding lettuce in my pockets for weeks,” he said, shaking his head.
          
          Emily looked at her now-empty grocery bag and laughed. “Well, I guess the salad bar’s going to have to wait.”
          
          They all parted ways with smiles on their faces, knowing they’d shared an unforgettable—and completely absurd—experience. As they left the building, Jake turned to Maya and said, “Same time next week? I hear celery’s tougher.”
          
          “Only if you’re ready to lose again,” Maya shot back with a grin.
          
          And with that, the group of strangers-turned-friends went their separate ways, each with a new story to tell.
          
          
        </p>
      </div>
        
      <form id="quiz-form">
        <div class="question" id="question1">
          <h3>Why did Mr. Harris eventually decide to participate in the lettuce-eating contest?</h3>
          <label><input type="radio" name="q1" value="incorrect"> He was pressured by the others to join in </label><br>
          <label><input type="radio" name="q1" value="incorrect"> He was determined to prove he could win </label><br>
          <label><input type="radio" name="q1" value="correct"> He wanted to pass the time and lighten his mood</label><br>
          <label><input type="radio" name="q1" value="incorrect"> He didn’t want to seem rude by refusing </label><br>
        </div>

        <div class="question" id="question2">
          <h3>What was the main reason Mrs. Turner suggested having a contest?</h3>
          <label><input type="radio" name="q2" value="incorrect"> To see who was the fastest eater in the group </label><br>
          <label><input type="radio" name="q2" value="incorrect"> To distract everyone from the anxiety of being stuck </label><br>
          <label><input type="radio" name="q2" value="incorrect"> To encourage teamwork among the strangers </label><br>
          <label><input type="radio" name="q2" value="correct"> To keep everyone occupied and entertained </label><br>
        </div>

        <div class="question" id="question3">
          <h3>Why was Emily’s attitude toward the contest more relaxed than the others?</h3>
          <label><input type="radio" name="q3" value="incorrect"> She was uninterested in eating raw lettuce </label><br>
          <label><input type="radio" name="q3" value="incorrect"> She knew she wouldn’t win against the younger participants </label><br>
          <label><input type="radio" name="q3" value="correct"> She didn’t see it as a serious competition and was there for the fun </label><br>
          <label><input type="radio" name="q3" value="incorrect"> She was too focused on worrying about her salad delivery </label><br>
        </div>

        <div class="question" id="question4">
          <h3>How did Maya’s competitive nature help her win the contest?</h3>
          <label><input type="radio" name="q4" value="correct"> She stayed focused and used her experience with tight deadlines </label><br>
          <label><input type="radio" name="q4" value="incorrect"> She distracted the others with jokes to slow them down </label><br>
          <label><input type="radio" name="q4" value="incorrect"> She had practiced competitive eating in college </label><br>
          <label><input type="radio" name="q4" value="incorrect"> She was hungrier than everyone else </label><br>
        </div>
        
        <div class="question" id="question5">
          <h3>Why did the sudden movement of the elevator affect the contest?</h3>
          <label><input type="radio" name="q5" value="incorrect"> It caused the elevator lights to flicker, blinding everyone </label><br>
          <label><input type="radio" name="q5" value="correct"> It startled the contestants and made them drop their lettuce</label><br>
          <label><input type="radio" name="q5" value="incorrect"> It made the participants stop eating due to fear </label><br>
          <label><input type="radio" name="q5" value="incorrect"> It ended the contest before anyone could finish </label><br>
        </div>

        <div class="question" id="question6">
          <h3>What does Mr. Thompson’s enjoyment of the contest despite his slow pace signify?</h3>
          <label><input type="radio" name="q6" value="correct"> He appreciated the opportunity to relive fond memories </label><br>
          <label><input type="radio" name="q6" value="incorrect"> He was secretly trying to sabotage the other contestants </label><br>
          <label><input type="radio" name="q6" value="incorrect"> He believed he could still win with a different strategy </label><br>
          <label><input type="radio" name="q6" value="incorrect"> He wanted to impress the younger participants </label><br>
        </div>

        <div class="question" id="question7">
          <h3>What did Jake’s suggestion of having a celery-eating contest next week reveal?</h3>
          <label><input type="radio" name="q7" value="incorrect"> He was upset about losing the contest </label><br>
          <label><input type="radio" name="q7" value="incorrect"> He was eager to challenge Maya to a rematch </label><br>
          <label><input type="radio" name="q7" value="correct"> He wanted to continue bonding with the group </label><br>
          <label><input type="radio" name="q7" value="incorrect"> He believed celery would be easier to eat than lettuce</label><br>
        </div>

        <div class="question" id="question8">
          <h3>What did the maintenance worker’s reaction imply about his thoughts on the group’s activity?</h3>
          <label><input type="radio" name="q8" value="correct"> He was confused but amused by their unconventional way of passing the time </label><br>
          <label><input type="radio" name="q8" value="incorrect"> He was annoyed at the mess they made with the lettuce </label><br>
          <label><input type="radio" name="q8" value="incorrect"> He thought they were wasting time when they could have been helping him </label><br>
          <label><input type="radio" name="q8" value="incorrect"> He felt responsible for putting them in such a stressful situation </label><br>
        </div>

        <button type="submit">Submit</button>

      </form>
    </div>

    <script>

      function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
      }

      var count = 0;
      var alerted = false;
      var audio = new Audio('media/658431__deathbyfairydust__pop.wav'); 
      // Array to hold gaze prediction points
      let gazePoints = [];
      webgazer.setGazeListener(function(data, elapsedTime) {
        if (data == null) {
            return;
        }

        var xprediction = data.x; // X coordinate
        var yprediction = data.y; // Y coordinate

        // Store the prediction point
        gazePoints.push({
          x: xprediction,
          y: yprediction,
          time: elapsedTime
        });
        
        var viewportWidth = window.innerWidth;
        var viewportHeight = window.innerHeight;

        var minX = viewportWidth * 0.1; 
        var maxX = viewportWidth * 0.9; 
        var minY = viewportHeight * 0.1; 
        var maxY = viewportHeight * 0.9; 

        // Check if gaze is off-screen
        if(alerted){

          async function changeAlert() {
            await sleep(15000);
            alerted = false;
          }

          changeAlert();

        } else {
          if (xprediction < minX || xprediction > maxX || yprediction < minY || yprediction > maxY) {
            count++;
            if(count > 30){
              try {
                // Send notification to server that user looked off screen
                fetch('/off-screen-counter', {
                  method: 'POST',
                });
              } catch (error) {
                console.error('Error:', error);
              }
              
              audio.play().catch(function(error) {
                console.error("Audio playback error:", error);
              });
              
              alerted = true;
              count = 0;
            }
          } else {
            count = 0;
          }
        }
      }).begin();
      webgazer.showPredictionPoints(false);
    </script>
  </body>
</html>
